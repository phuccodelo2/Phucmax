--// Dịch vụ
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hum = character:WaitForChild("HumanoidRootPart")

--// UI
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.Name = "BossFarmUI"

local toggleUIButton = Instance.new("TextButton")
toggleUIButton.Size = UDim2.new(0, 100, 0, 30)
toggleUIButton.Position = UDim2.new(0, 10, 0, 10)
toggleUIButton.Text = "Ẩn/Hiện UI"
toggleUIButton.Parent = ScreenGui

local mainUI = Instance.new("Frame")
mainUI.Size = UDim2.new(0, 200, 0, 140)
mainUI.Position = UDim2.new(0, 10, 0, 50)
mainUI.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
mainUI.Visible = true
mainUI.Parent = ScreenGui

local toggleFarmButton = Instance.new("TextButton")
toggleFarmButton.Size = UDim2.new(1, -20, 0, 30)
toggleFarmButton.Position = UDim2.new(0, 10, 0, 10)
toggleFarmButton.Text = "Bật Farm Boss"
toggleFarmButton.Parent = mainUI

-- Nhập khoảng cách
local radiusBox = Instance.new("TextBox")
radiusBox.Size = UDim2.new(1, -20, 0, 30)
radiusBox.Position = UDim2.new(0, 10, 0, 50)
radiusBox.PlaceholderText = "Khoảng cách (VD: 22)"
radiusBox.Text = "22"
radiusBox.ClearTextOnFocus = false
radiusBox.Parent = mainUI

-- Hiện máu NPC
local healthLabel = Instance.new("TextLabel")
healthLabel.Size = UDim2.new(0, 250, 0, 30)
healthLabel.Position = UDim2.new(1, -260, 0, 10)
healthLabel.BackgroundTransparency = 1
healthLabel.TextColor3 = Color3.new(1, 0, 0)
healthLabel.Font = Enum.Font.SourceSansBold
healthLabel.TextSize = 20
healthLabel.Text = "Máu Boss: ??"
healthLabel.Parent = ScreenGui

--// Logic
local farmActive = false

toggleUIButton.MouseButton1Click:Connect(function()
	mainUI.Visible = not mainUI.Visible
end)

toggleFarmButton.MouseButton1Click:Connect(function()
	farmActive = not farmActive
	toggleFarmButton.Text = farmActive and "Tắt Farm Boss" or "Bật Farm Boss"
end)

--// Hàm tìm NPC2
function getNPC2()
	for _, v in pairs(workspace:GetDescendants()) do
		if v:IsA("Model") and v.Name == "NPC2" and v:FindFirstChild("HumanoidRootPart") then
			return v
		end
	end
end

--// Hàm lấy tool
function getTool()
	for _, item in pairs(player.Backpack:GetChildren()) do
		if item:IsA("Tool") then
			return item
		end
	end
	for _, item in pairs(character:GetChildren()) do
		if item:IsA("Tool") then
			return item
		end
	end
end

--// Vòng lặp xử lý
RunService.RenderStepped:Connect(function()
	if not farmActive then return end

	local npc = getNPC2()
	if npc and npc:FindFirstChild("Humanoid") then
		local npcRoot = npc:FindFirstChild("HumanoidRootPart")
		local human = npc:FindFirstChild("Humanoid")

		local radius = tonumber(radiusBox.Text) or 22
		local angle = tick() * 2
		local x = math.cos(angle) * radius
		local z = math.sin(angle) * radius
		local position = npcRoot.Position + Vector3.new(x, 0, z)

		hum.CFrame = CFrame.new(position, npcRoot.Position + Vector3.new(0, 2, 0))

		local tool = getTool()
		if tool and tool:FindFirstChild("Activate") then
			tool:Activate()
		end

		healthLabel.Text = "Máu Boss: " .. math.floor(human.Health) .. " / " .. math.floor(human.MaxHealth)
	end
end)
