--// Dịch vụ
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local SoundService = game:GetService("SoundService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hum = character:WaitForChild("HumanoidRootPart")

--// Biến
local farmActive = false
local musicPlaying = false
local farmDistance = 20
local sound = Instance.new("Sound", SoundService)

--// UI tạo
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "BossFarmUI"
gui.ResetOnSpawn = false

-- Logo tròn góc trái
local logo = Instance.new("ImageLabel", gui)
logo.Size = UDim2.new(0, 50, 0, 50)
logo.Position = UDim2.new(0, 10, 0, 10)
logo.BackgroundTransparency = 1
logo.Image = "rbxassetid://113632547593752" -- <-- Thay ID logo tại đây
logo.ImageColor3 = Color3.new(1,1,1)

-- UI chính
local main = Instance.new("Frame", gui)
main.Size = UDim2.new(0, 350, 0, 280)
main.Position = UDim2.new(0.5, -175, 0.5, -140)
main.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
main.BorderSizePixel = 0
main.BackgroundTransparency = 0.1
main.ClipsDescendants = true

-- Viền rainbow
local stroke = Instance.new("UIStroke", main)
stroke.Thickness = 2
stroke.LineJoinMode = Enum.LineJoinMode.Round

-- Bo góc
local corner = Instance.new("UICorner", main)
corner.CornerRadius = UDim.new(0, 10)

-- Chữ phucmax rainbow
local title = Instance.new("TextLabel", main)
title.Size = UDim2.new(1, 0, 0, 40)
title.Position = UDim2.new(0, 0, 0, 0)
title.Text = "phucmax"
title.Font = Enum.Font.GothamBold
title.TextSize = 28
title.BackgroundTransparency = 1
title.TextColor3 = Color3.new(1, 1, 1)

-- Nút bật/tắt Farm
local toggleFarm = Instance.new("TextButton", main)
toggleFarm.Size = UDim2.new(0.9, 0, 0, 30)
toggleFarm.Position = UDim2.new(0.05, 0, 0, 50)
toggleFarm.Text = "Bật Farm Boss"
toggleFarm.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
toggleFarm.TextColor3 = Color3.new(1, 1, 1)
Instance.new("UICorner", toggleFarm)

-- Nhập khoảng cách
local distBox = Instance.new("TextBox", main)
distBox.Size = UDim2.new(0.9, 0, 0, 30)
distBox.Position = UDim2.new(0.05, 0, 0, 90)
distBox.PlaceholderText = "Khoảng cách vd22"
distBox.Text = ""
distBox.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
distBox.TextColor3 = Color3.new(1, 1, 1)
Instance.new("UICorner", distBox)

-- Bật/tắt nhạc
local musicBtn = Instance.new("TextButton", main)
musicBtn.Size = UDim2.new(0.9, 0, 0, 30)
musicBtn.Position = UDim2.new(0.05, 0, 0, 130)
musicBtn.Text = "Bật Nhạc"
musicBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
musicBtn.TextColor3 = Color3.new(1, 1, 1)
Instance.new("UICorner", musicBtn)

-- Nhập ID nhạc
local musicBox = Instance.new("TextBox", main)
musicBox.Size = UDim2.new(0.9, 0, 0, 30)
musicBox.Position = UDim2.new(0.05, 0, 0, 170)
musicBox.PlaceholderText = "ID Nhạc"
musicBox.Text = ""
musicBox.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
musicBox.TextColor3 = Color3.new(1, 1, 1)
Instance.new("UICorner", musicBox)

-- Label máu boss
local healthLabel = Instance.new("TextLabel", main)
healthLabel.Size = UDim2.new(0.9, 0, 0, 30)
healthLabel.Position = UDim2.new(0.05, 0, 0, 210)
healthLabel.Text = "Máu Boss: ??"
healthLabel.TextColor3 = Color3.new(1, 0, 0)
healthLabel.BackgroundTransparency = 1
healthLabel.TextSize = 20
healthLabel.Font = Enum.Font.SourceSansBold

-- Ẩn/Hiện UI
local toggleUI = Instance.new("TextButton", gui)
toggleUI.Size = UDim2.new(0, 100, 0, 30)
toggleUI.Position = UDim2.new(0, 70, 0, 20)
toggleUI.Text = "Ẩn/Hiện UI"
toggleUI.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
toggleUI.TextColor3 = Color3.new(1, 1, 1)
Instance.new("UICorner", toggleUI)

-- Rainbow hiệu ứng
spawn(function()
	while true do
		local t = tick() * 0.5
		local r = math.sin(t) * 0.5 + 0.5
		local g = math.sin(t + 2) * 0.5 + 0.5
		local b = math.sin(t + 4) * 0.5 + 0.5
		local color = Color3.new(r, g, b)
		stroke.Color = color
		title.TextColor3 = color
		task.wait(0.05)
	end
end)

-- Toggle UI
toggleUI.MouseButton1Click:Connect(function()
	main.Visible = not main.Visible
end)

-- Toggle Farm
toggleFarm.MouseButton1Click:Connect(function()
	farmActive = not farmActive
	toggleFarm.Text = farmActive and "Tắt Farm Boss" or "Bật Farm Boss"
end)

-- Toggle Nhạc
musicBtn.MouseButton1Click:Connect(function()
	if musicPlaying then
		sound:Stop()
		musicBtn.Text = "Bật Nhạc"
	else
		local id = tonumber(musicBox.Text)
		if id then
			sound.SoundId = "rbxassetid://" .. id
			sound.Looped = true
			sound.Volume = 100
			sound:Play()
			musicBtn.Text = "Tắt Nhạc"
		end
	end
	musicPlaying = not musicPlaying
end)

-- Tìm NPC2
function getNPC2()
	for _, v in pairs(workspace:GetDescendants()) do
		if v:IsA("Model") and v.Name == "NPC2" and v:FindFirstChild("HumanoidRootPart") then
			return v
		end
	end
end

-- Vòng lặp farm
RunService.RenderStepped:Connect(function()
	if not farmActive then return end

	local npc = getNPC2()
	if npc and npc:FindFirstChild("Humanoid") then
		local npcRoot = npc:FindFirstChild("HumanoidRootPart")
		local human = npc:FindFirstChild("Humanoid")

		local dist = tonumber(distBox.Text)
		local radius = dist or 20
		local angle = tick() * 3
		local x = math.cos(angle) * radius
		local z = math.sin(angle) * radius
		local pos = npcRoot.Position + Vector3.new(x, 0, z)

		hum.CFrame = CFrame.new(pos, npcRoot.Position + Vector3.new(0, 2, 0))

		VirtualInputManager:SendMouseButtonEvent(500, 500, 0, true, game, 1)
VirtualInputManager:SendMouseButtonEvent(500, 500, 0, false, game, 1)

		healthLabel.Text = "Máu Boss: " .. math.floor(human.Health) .. " / " .. math.floor(human.MaxHealth)
	end
end)
